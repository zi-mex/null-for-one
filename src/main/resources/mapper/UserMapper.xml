<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.platform.mapper.UserMapper">

    <!--
    useGeneratedKeys="true"
    设置允许Mybatis在插入操作后获取该生成的键

    keyProperty="id"
    指定Java对象中将存储生成的键的属性，在插入操作完成后，Mybatis会将生成的键值赋值给这个属性
    -->
    <insert id="insert" parameterType="com.project.platform.entity.User"
    useGeneratedKeys="true"
    keyProperty="id"
    >
        INSERT INTO user
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="username!=null">username,</if>
            <if test="password!=null">password,</if>
            <if test="nickname!=null">nickname,</if>
            <if test="avatarUrl!=null">avatar_url,</if>
            <if test="tel!=null">tel,</if>
            <if test="email!=null">email,</if>
            <if test="status!=null">status,</if>
            <if test="balance!=null">balance,</if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="username!=null">#{username},</if>
            <if test="password!=null">#{password},</if>
            <if test="nickname!=null">#{nickname},</if>
            <if test="avatarUrl!=null">#{avatarUrl},</if>
            <if test="tel!=null">#{tel},</if>
            <if test="email!=null">#{email},</if>
            <if test="status!=null">#{status},</if>
            <if test="balance!=null">#{balance},</if>
        </trim>
    </insert>

    <update id="updateById" parameterType="com.project.platform.entity.User">
        UPDATE user
        <set>
            <if test="username!=null">
                username=#{username},
            </if>
            <if test="password!=null">
                password=#{password},
            </if>
            <if test="nickname!=null">
                nickname=#{nickname},
            </if>
            <if test="avatarUrl!=null">
                avatar_url=#{avatarUrl},
            </if>
            <if test="tel!=null">
                tel=#{tel},
            </if>
            <if test="email!=null">
                email=#{email},
            </if>
            <if test="status!=null">
                status=#{status},
            </if>
            <if test="balance!=null">
                balance=#{balance},
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <delete id="removeByIds">
        DELETE FROM user
        WHERE id IN
        <foreach item="id" collection="list" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!--分页模糊查询-->
    <select id="queryPage" resultType="com.project.platform.entity.User">
        SELECT user.*
        FROM user
        <include refid="queryConditions" />
        ORDER BY user.id DESC
        LIMIT #{offset} , #{pageSize}
    </select>


    <!--查询条件-->
    <sql id="queryConditions">
        <where>
            <if test="query.username != null and query.username.trim() != '' ">
                AND user.username LIKE CONCAT('%',#{query.username},'%')
            </if>
            <if test="query.tel != null and query.tel.trim() != '' ">
                AND user.tel LIKE CONCAT('%',#{query.tel},'%')
            </if>
            <if test="query.status != null and query.status .trim() != '' ">
                AND user.status  LIKE CONCAT('%',#{query.status },'%')
            </if>
        </where>
    </sql>
    <!--查询总数-->
    <select id="queryCount" resultType="java.lang.Integer">
        SELECT count(user.id) FROM user
        <include refid="queryConditions"></include>
    </select>

</mapper>